<f:comment>
    <!--
 * (c) Kitodo. Key to digital objects e.V. <contact@kitodo.org>
 *
 * This file is part of the Kitodo and TYPO3 projects.
 *
 * @license GNU General Public License version 3 or later.
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
-->
</f:comment>
<html xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers" 
      data-namespace-typo3-fluid="true">

<f:comment>
    <f:debug>{_all}</f:debug>
</f:comment>

<f:for each="{children}" as="child">
    <!-- 17: child.type: {child.type} -->
    <f:switch expression="{child.ITEM_STATE}">
        <f:case value="ACT">
            <li class="tx-dlf-toc-act active {child.type}">
        </f:case>
        <f:case value="CUR">
            <li class="tx-dlf-toc-cur current {child.type}">
        </f:case>
        <f:case value="ACTIFSUB">
            <f:if condition="{child.doNotLinkIt}">
                <f:then>
                    <li class="tx-dlf-toc-act tx-dlf-toc-ifsub active submenu doNotLinkIt {child.type}">
                </f:then>
                <f:else>
                    <li class="tx-dlf-toc-act tx-dlf-toc-ifsub active submenu {child.type}">
                </f:else>
            </f:if>
        </f:case>
        <f:case value="CURIFSUB">
            <li class="tx-dlf-toc-cur tx-dlf-toc-ifsub current submenu {child.type}">
        </f:case>
        <f:case value="IFSUB">
            <f:if condition="{child.doNotLinkIt}">
                <f:then>
                    <li class="tx-dlf-toc-no tx-dlf-toc-ifsub submenu doNotLinkIt {child.type}">
                </f:then>
                <f:else>
                    <li class="tx-dlf-toc-no tx-dlf-toc-ifsub submenu {child.type}">
                </f:else>
            </f:if>
        </f:case>
        <f:defaultCase>
            <li class="tx-dlf-toc-no default {child.type} c50">
        </f:defaultCase>
    </f:switch>

    <f:if condition="{child.doNotLinkIt}">
        <f:then>
            <span class="ma-toc-title a doNotLinkIt {child.type}">
                <!-- LINE 59: {child.id} {child.type} {child.AnchorDocumentId} -->
                <f:render partial="TableOfContents/Title" arguments="{child: child}"/>
            </span>
        </f:then>
        <f:else>
            <f:comment>
                there is a mistake with newspaper issues 
                additionalParams="{f:if(condition:'{child.id}', then:'{\'tx_dlf[id]\':child.id, \'tx_dlf[page]\':child.page}', else: '{\'tx_dlf[page]\':child.page}')}" 
                if this part is omitted from newspapers or periodikas, everything seems to work. Otherwise an oop error is displayed. The cause could possibley be a 
                problem with the child.id, which in my first test case is a URL and not a number. 
                At the moment the error does not occur because i have commented out settings in config.yaml
                I fixed the Problem with child.parentDocumentId or child.AnchorDocumentId
                I use child.AnchorDocumentId for newspapers because child.parentDocumentId has the id to the year
                Manuelles setzen der ID nicht mehr notwendig!
            </f:comment>
            <f:if condition="{child.ITEM_STATE} == 'ACTIFSUB' && ({child.type} == 'Zeitung' || {child.type} == 'Newspaper')">
                <f:then>
                    <f:comment><f:debug>child.ITEM_STATE == ACTIFSUB and Zeitung</f:debug></f:comment>
                    <f:comment><f:debug>{_all}</f:debug></f:comment>
                    <f:comment><f:render partial="TableOfContents/Title" arguments="{child: child}" /></f:comment>
                    <f:comment><f:debug>{child.title}</f:debug></f:comment>
                    <f:comment><f:debug>Ausgabe: child.id: {child.id}</f:debug></f:comment>
                    <f:comment>
                        wenn ich hier angekommen bin dann bin ich in einer Heftausgabe!
                        Jetzt setze ich die Variable newspaper_level auf day und damit kann ich dann wieder das 
                        Inhaltsverzeichnis anzeigen
                    </f:comment>

                    <f:variable name="xChildId" value="{child.AnchorDocumentId}" />
                    <f:variable name="newspaper_level" value="day" />
              
                    <f:if condition="{xChildId} != '---'">
                        <f:then>
                            <f:comment>
                                <f:debug>99</f:debug>
                                <f:debug>{_all}</f:debug>
                                <f:debug>{child.AnchorDocumentId}</f:debug>
                            </f:comment>
                            <!-- 103 Ansicht Detail Titel -->
                            <!-- child.id: '{child.id}' -->
                            <!-- child.type: '{child.type}'  child.AnchorDocumentId: '{child.AnchorDocumentId}' -->
                            <f:link.action 
                                action="main" 
                                pageUid="{settings.targetPid}" 
                                additionalParams="{f:if(condition:'{xChildId}', then:'{\'tx_dlf[id]\':xChildId, \'tx_dlf[page]\':child.page}', else: '{\'tx_dlf[page]\':child.page}')}" 
                                addQueryString="1" 
                                addQueryStringMethod="GET"
                                title="{f:if(condition:'{child.title}', then: '{child.title}', else: '{child.type}')}">
                                <f:render partial="TableOfContents/Title" arguments="{child: child}" />
                            </f:link.action>
                        </f:then>
                    </f:if>
                </f:then>
                
                <f:else>
                    <f:comment>from condition="{child.ITEM_STATE} == 'ACTIFSUB' && ({child.type} == 'Zeitung' || {child.type} == 'Newspaper')" </f:comment>
                    <f:comment>
                        <f:debug>child.ITEM_STATE != ACTIFSUB</f:debug>
                        <f:debug>{_all}</f:debug>
                    </f:comment>		      
                    <!-- link bilden start 129 -->
                    <!-- child.ITEM_STATE != ACTIFSUB -->
                    <!-- child.id: {child.id} child.page: {child.page} -->
                    <!-- child.type: {child.type} -->
                    <!-- child.type-index: {child.type-index} -->
                    <!-- child.ownDocumentId: {child.ownDocumentId} -->
                    <f:comment>addQueryString="1" 
                        addQueryStringMethod="GET"
                    </f:comment>

                    <f:comment>
                        <f:debug>{_all}</f:debug>
                    </f:comment>

                    <f:comment>
                        Problem mit child.id / points die url statt id sind beseitigen, 
                        korrespondiert mit Anpassung in TableOfContentsControler.php
                    </f:comment>
                    <f:if condition="{child.id}">
                        <f:then>
                            <!-- Ja Child-Id liegt vor: child.id: {child.id} -->
                            <f:variable name="xChildId" value="{child.id}" />
                        </f:then>
                        <f:else>
                            <!-- Nein: child.id: {child.id} ist leer -->
                            <!-- aber child.ownDocumentId liegt vor: {child.ownDocumentId} -->
                            <f:variable name="xChildId" value="{child.ownDocumentId}" />
                            <f:comment>
                                    <f:if condition="{child.AnchorDocumentId}">
                                        <f:then>
                                            <!-- child.AnchorDocumentId: {child.AnchorDocumentId} -->
                                            <f:variable name="xChildId" value="{child.AnchorDocumentId}" />
                                        </f:then>
                                        <f:else>
                                            <!-- kein child.AnchorDocumentId -->
                                            <f:if condition="{child.parentDocumentId}">
                                                <f:then>
                                                    <!-- child.parentDocumentId: {child.parentDocumentId}-->
                                                    <f:variable name="xChildId" value="{child.parentDocumentId}" />
                                                </f:then>
                                                <f:else>
                                                    <!-- keine child.parentDocumentId und child.AnchorDocumentId -->
                                                    <f:variable name="xChildId" value="{child.id}" />
                                                </f:else>
                                            </f:if>
                                        </f:else>
                                    </f:if>
                            </f:comment>
                        </f:else>
                    </f:if>
            
                    <!-- 170 Ansicht ZSS und Ztg: Jahre + Kalender  / Mono: Detailansicht + anchor -->
                    <!-- child.id: '{child.id}' child.type: '{child.type}'  child.AnchorDocumentId: '{child.AnchorDocumentId}' child.ownDocumentId: {child.ownDocumentId} -->
                    <f:link.action 
                        action="main" 
                        pageUid="{settings.targetPid}" 
                        additionalParams="{f:if(condition:'{xChildId}', then:'{\'tx_dlf[id]\':xChildId, \'tx_dlf[page]\':child.page}', else: '{\'tx_dlf[page]\':child.page}')}" 
                        addQueryString="untrusted" 
                        title="{f:if(condition:'{child.title}', then: '{child.title}', else: '{child.type}')}">
                        <f:render partial="TableOfContents/Title" arguments="{child: child}" />
                    </f:link.action>
                    <!-- Link bilden ende -->
                </f:else>
            </f:if>
        </f:else>
    </f:if>

    <f:if condition="{settings.basketButton} && {settings.targetBasket}">
        <span class="tx-dlf-basket-button">
            <f:link.action
                pageUid="{settings.targetBasket}"
                action="main"
                controller="Basket"
                additionalParams="{'tx_dlf[addToBasket]':'toc', 'tx_dlf[logId]':child.basketButton.logId, 'tx_dlf[startpage]':child.basketButton.startpage, 'tx_dlf_basket[action]':'add', 'tx_dlf_basket[controller]':'Basket'}"
                addQueryString="1">
                    <f:translate key="basket.addBasket" />
            </f:link.action>
        </span>
    </f:if>

    <f:variable name="cULType" value="ul" />
    <f:if condition="{child._SUB_MENU} && ({child.ITEM_STATE} == 'IFSUB' || {child.ITEM_STATE} == 'ACTIFSUB' || {child.ITEM_STATE} == 'CURIFSUB')">
        <f:if condition="{child.doNotLinkIt}">
            <f:then>
                <f:if condition="({child.type} == 'Monat' || {child.type} == 'Tag')">
                    <f:then>
                        <f:variable name="cULClass" value="span" />
                    </f:then>
                    <f:else>
                        <f:variable name="cULClass" value="ul" />
                    </f:else>
                </f:if>
                <ul class="doNotLinkIt {child.type} {cULClass} child-175">
            </f:then>
            <f:else>
                <f:comment><f:debug>{_all}</f:debug></f:comment>
        <f:comment>
        <f:debug>{_all}</f:debug>
        <f:debug>{child._SUB_MENU.0.type}</f:debug>
        </f:comment>
        <f:if condition="{child.type} == 'Zeitung'  && {newspaper_level } != 'day'">
            <f:then>
                <f:variable name="hide_newspaper_toc_details" value="hide_newspaper_toc_details" />
            </f:then>
            <f:else>
                <f:variable name="hide_newspaper_toc_details" value="" />
            </f:else>
        </f:if>
        <{cULType} class="normal {child.type} child-188 {hide_newspaper_toc_details} {newspaper_level} {child._SUB_MENU.0.type}">
            </f:else>
        </f:if>
        <f:render partial="TableOfContents/Children" arguments="{children: child._SUB_MENU}" />
        </ul>
    </f:if>

    </li>
</f:for>
